<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nexty Session Generator</title>
<style>
  body {
    background: #000;
    color: #0ff;
    font-family: monospace;
    text-align: center;
    padding-top: 80px;
  }
  h1 { color: #00ffe6; }
  input {
    background: #111;
    border: 1px solid #00ffe6;
    border-radius: 8px;
    color: #0ff;
    padding: 10px;
    width: 220px;
    text-align: center;
    margin-bottom: 10px;
  }
  button {
    background: #00ffe6;
    color: #000;
    padding: 10px 25px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-weight: bold;
  }
  #pairCodeBox, #sessionBox {
    margin-top: 30px;
    padding: 15px;
    background: #111;
    border-radius: 12px;
    display: inline-block;
    min-width: 250px;
  }
  #pairCode {
    font-size: 26px;
    letter-spacing: 5px;
    color: #0ff;
  }
</style>
</head>
<body>
  <h1>Nexty Session ID Generator</h1>

  <input id="number" placeholder="Enter phone (923001234567)" />
  <br>
  <button onclick="start()">Generate Pair Code</button>

  <div id="pairCodeBox"></div>
  <div id="sessionBox"></div>

  <script>
    async function start() {
      const num = document.getElementById("number").value.trim();
      if (!num) {
        alert("Please enter your phone number (e.g. 923001234567)");
        return;
      }

      document.getElementById("pairCodeBox").innerHTML = "Generating Pair Code...";
      const res = await fetch("/start", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ number: num })
      });
      const data = await res.json();
      checkPairCode(data.clientId);
    }

    async function checkPairCode(id) {
      let timer = setInterval(async () => {
        let res = await fetch(`/pair?clientId=${id}`);
        let pair = await res.json();
        if (pair.code) {
          document.getElementById("pairCodeBox").innerHTML =
            `<b>ðŸ”— Pair this code in WhatsApp:</b><br><div id='pairCode'>${pair.code}</div>`;
        }

        let sres = await fetch(`/session?clientId=${id}`);
        let sess = await sres.json();
        if (sess.session) {
          clearInterval(timer);
          document.getElementById("pairCodeBox").innerHTML = "";
          document.getElementById("sessionBox").innerHTML =
            `<b>âœ… Your Session ID:</b><br><code>${sess.session}</code>`;
        }
      }, 2500);
    }
  </script>
</body>
</html>
